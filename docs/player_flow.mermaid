sequenceDiagram
    participant Player
    participant GameEngine
    participant NarrativeGenerator
    participant CharacterManager
    participant WorldManager
    participant MapManager
    participant EventManager
    participant NarrativeStructuring
    participant PromptManager
    participant LLMIntegration
    participant LLM

    Player ->> GameEngine: Perform Action
    GameEngine ->> NarrativeGenerator: Trigger Narrative Generation
    NarrativeGenerator ->> CharacterManager: Get Character Data
    NarrativeGenerator ->> WorldManager: Get World State
    NarrativeGenerator ->> MapManager: Get Map State
    NarrativeGenerator ->> EventManager: Update and Check Events
    NarrativeGenerator ->> NarrativeStructuring: Determine Narrative Structure (using Character Data, World State, Map State, Events)
    NarrativeStructuring ->> MapManager: Integrate Map Details
    NarrativeStructuring ->> EventManager: Integrate Event Effects
    NarrativeGenerator ->> PromptManager: Generate Prompt
    PromptManager ->> LLMIntegration: Send Prompt
    LLMIntegration ->> LLM: Send Prompt
    LLM ->> LLMIntegration: Return Narrative Text
    LLMIntegration ->> NarrativeGenerator: Pass Narrative Text
    NarrativeGenerator ->> GameEngine: Integrate Narrative Text
    GameEngine ->> Player: Display Narrative
