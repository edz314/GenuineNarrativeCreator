**Project Architecture Overview**

**Introduction**
This document provides an overview of the architecture of the narrative-driven game system. It details the key components, their responsibilities, and how they interact to generate dynamic narratives using a Large Language Model (LLM). The architecture is designed to be modular, allowing for easy maintenance, scalability, and integration of additional features.

**Core Components**

**1. Narrative Generator**
Purpose: The Narrative Generator is responsible for generating narrative text based on player actions, character states, map states, active events, and the game world's current conditions. It interacts with various components like CharacterManager, WorldManager, MapManager, EventManager, and NarrativeStructuring to craft a coherent story.
Key Responsibilities:

Validate player actions.
Retrieve relevant character, world, map, and event data.
Utilize the PromptManager to create prompts for the LLM.
Generate narrative text using the LLM's output.

**2. Prompt Manager**
Purpose: The Prompt Manager centralizes the creation and adaptation of prompts sent to the LLM. It ensures that all prompts are contextually relevant and consistent with the narrative structure, considering character, world, map, and event contexts.
Key Responsibilities:

Construct prompts based on the narrative scenario, character traits, world state, map details, and current events.
Adapt prompts to fit specific narrative needs, such as changing tone or urgency.
Manage and utilize various prompt templates tailored for different scenarios.

**3. LLM Integration**
Purpose: The LLM Integration component handles the interaction between the game system and the Large Language Model (LLM). It sends prompts generated by the PromptManager to the LLM and retrieves the generated narrative text.
Key Responsibilities:

Initialize and manage the connection to the LLM's API or local instance.
Send prompts to the LLM and process the response.
Integrate the LLM-generated text back into the narrative generation process

**4. Narrative Structuring**
Purpose: The Narrative Structuring component defines the flow of the narrative, determining how different narrative elements (e.g., setup, conflict, resolution) are pieced together. It considers character data, world state, map details, and active events to ensure that the generated narrative follows a coherent structure.
Key Responsibilities:

Create narrative structures based on player actions, character states, world conditions, map states, and active events.
Provide structured templates to the PromptManager for prompt generation.
Adapt narrative elements dynamically to reflect changes in the map and ongoing events.

**5. Character Manager**
Purpose: The Character Manager handles the management of characters within the game world. It provides character-specific data and states to the Narrative Generator, influencing narrative generation.
Key Responsibilities:

Manage character traits, histories, and current states.
Provide access to character-specific dialogue and actions.
Integrate character development into the narrative generation process.
Adjust character states in response to events managed by the EventManager.

**6. Map Manager**
Purpose: The Map Manager handles the management and generation of map data, including terrain types, landmarks, and dynamic elements. It provides spatial context to the Narrative Generator, ensuring that narratives reflect the player's environment.
Key Responsibilities:

Manage and generate map layouts, terrain types, and landmarks.
Provide map state data that influences the narrative, such as environmental features.
Integrate dynamic elements into the map that can change based on player actions or events

**7. World Manager**
Purpose:
The World Manager manages the state of the game world, including locations, environmental factors, and overall world conditions.
It supplies relevant world data to the Narrative Generator.
Key Responsibilities:
Track the state of various locations and environmental factors.
Provide world-related data that influences the narrative.
Ensure that world changes are reflected in the generated narrative.

**8. Event Manager**
Purpose: The Event Manager tracks and manages game events, ensuring that the narrative can adapt dynamically to changes in the game world. It plays a crucial role in making the game world feel responsive and alive.
Key Responsibilities:

Update and manage the state of various game events.
Provide data on active events that influence the narrative.
Trigger narrative or gameplay changes based on event conditions.

**7. Context Management**
Purpose: While not fully implemented as a standalone component, context management is critical for maintaining narrative coherence. It tracks past interactions, character developments, and ongoing story arcs, feeding this information to the PromptManager and NarrativeGenerator.
Key Responsibilities:

Maintain a record of previous player actions and narrative decisions.
Provide context to the PromptManager for more accurate and context-aware prompt generation.

**Workflow Overview**

**Player Interaction:**

The player performs an action within the game, which is captured by the game engine.

**Narrative Generation:**

The Narrative Generator validates the action and retrieves the current state of the world and characters.
It interacts with the Narrative Structuring component to determine the narrative structure required for the current scenario.

**Prompt Creation:**

The Prompt Manager creates a contextually appropriate prompt based on the narrative structure, character data, and world state.
The prompt may be adapted to fit specific needs, such as altering tone or urgency.

**LLM Interaction:**

The LLM Integration component sends the prompt to the LLM and receives the generated narrative text.

**Narrative Output:**

The generated narrative text is returned by the LLM Integration and integrated back into the game, where it is presented to the player.
Future Considerations

**Context Manager:**

Implementing a dedicated Context Manager would enhance the system's ability to maintain long-term narrative coherence, particularly in complex, branching narratives.
Advanced Prompt Management:

As the narrative complexity grows, the Prompt Manager could be expanded to handle multi-character interactions, cross-references between different narrative arcs, and more sophisticated tone and style adaptations.

**Narrative Generation Flow Diagram**

**1. Flow Overview:**

This is the player flow expressed as a mermaid diagram

(https://github.com/edz314/GenuineNarrativeCreator/blob/main/docs/player_flow.mermaid)

****2. Detailed Component Interaction:**

**Narrative Generation Process:****

**Player Action:**

The player performs an action within the game (e.g., interacts with a character, explores a location, triggers an event).
Narrative Generator:

The Narrative Generator receives the player action and validates it.
It retrieves the current game state from the Character Manager and World Manager.
It determines the narrative structure needed using Narrative Structuring.
Prompt Manager:

The Prompt Manager generates a prompt based on the scenario, character, and context provided by the Narrative Generator.
If necessary, it adapts the prompt (e.g., changes the tone, urgency, or style).
LLM Integration:

The LLM Integration sends the generated prompt to the LLM API or local model.
It waits for the response and retrieves the narrative text generated by the LLM.
LLM:

The LLM processes the prompt and generates narrative text based on the input.
Narrative Text:

The generated narrative text is sent back to the LLM Integration component.
Game Engine:

The narrative text is integrated into the game’s ongoing narrative and displayed to the player.

**Player:**

The player receives the narrative output as part of their gameplay experience.
Flow Diagram Logic Representation:
**Start - Player Action:**

The flow starts with the player action that triggers the narrative generation process.

**Narrative Generator:**

Input: Player Action, Current Game State (Characters, World).
Process:
Validate player action.
Retrieve character and world data.
Determine narrative structure.
Output: Narrative Structure, Context.

**Prompt Manager:**

Input: Narrative Structure, Context, Characters, World State.
Process:
Generate the prompt based on input.
Adapt the prompt if necessary (tone, urgency).
Output: Finalized Prompt.

**LLM Integration:**

Input: Finalized Prompt.
Process:
Send prompt to the LLM.
Wait for and retrieve generated text.
Output: Generated Narrative Text.

**LLM:**

Input: Prompt.
Process:
Generate narrative text based on the prompt.
Output: Narrative Text.

**Game Engine:**

Input: Generated Narrative Text.
Process:
Integrate narrative text into the game’s current state.
Output: Updated Game State with new narrative.

**End - Player Receives Narrative:**

The player sees the narrative unfold based on their previous actions.

**High Level Architecture:**

This is the high level component architecture expressed as a mermaid diagram:

(https://github.com/edz314/GenuineNarrativeCreator/blob/main/docs/high_level_architecture.mermaid)

**Low Level Architecture:**

This is the low level logical architecture expressed as a mermaid diagram:

(https://github.com/edz314/GenuineNarrativeCreator/blob/main/docs/low_level_architecture.mermaid)

**Scalability:**

The architecture is designed to be modular and scalable, allowing for the integration of additional narrative features, such as dynamic world events, complex character arcs, and multi-threaded storylines.
